<!DOCTYPE html>
<html lang="en">

<head>
  <title>Feed</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" type="text/css" href="/public/feed.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="/public/home.css" />
  <script src="/public/script.js" defer></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
</head>

<body>
  <header><%- include('partials/navbar') %></header>

  <div class="mainPage">
    <div id="feed">
      <!-- <div id="feed-header"> -->
      <h1 id="feed-header">
        <%= category.catName %> Feed
      </h1>
      <!-- </div> -->
      <div class="nav-buttons">
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#filterModal">
          Filter
        </button>
        <button id="viewPostsButton" class="btn btn-secondary" onclick="toggleView('posts')">
          View Posts
        </button>
        <button id="viewResourcesButton" class="btn btn-secondary" onclick="toggleView('resources')">
          View Resources
        </button>
        <% if (role==='teacher' ) { %>
          <div>
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#resourceModal">
              Add Resource
            </button>
          </div>
          <% } %>
            <div>
              <button type="button" id="postButton" class="btn btn-primary" data-bs-toggle="modal"
                data-bs-target="#postModal">
                Post
              </button>
            </div>
      </div>

      <div id="feed-content" style="position: relative;">
        <% if (!posts || posts.length===0) { %>
          <h2>No posts found, be the first to make one!</h2>
          <% } else { %>
            <% posts.forEach(post=> { %>
              <div class="grows" style="position: relative; margin-bottom: 32vh; display: flex; flex-direction: column;">
                <div id="postBox" style="width: 42vw; height: 20vh; left: 7.6vw; top: 10.7vh; position: absolute; background: rgb(255, 251, 215); border-radius: 1.9vw; border: 0.3vw rgb(0, 0, 0) solid;"> </div>
                <div class="grows" style="width: 4vw; height: 4vw; left: 9.4vw; top: 22vh; position: absolute; background: white; border-radius: 50%; border: 0.1vw black solid;">
                  <a href="/account/<%= post.userId %>">
                    <img src="/images/<%= post.profilePic %>" class="rounded-circle" alt="profile" style="width: 100%; height: 100%; object-fit: cover;">
                  </a>
                </div>
                <div style="width: 50vw; height: 2.7vh; left: 14.6vw; top: 22.5vh; position: absolute; color: black; font-size: 2vw; font-family: Inter; font-weight: 400; word-wrap: break-word;">
                  <a href="/account/<%= post.userId %>"><%= post.fname + " " + post.lname %></a>
                </div>
                <div id="dots" class="grows" style="position: absolute; left: 45vw; top: 22vh;" onclick="toggleButtons('buttons-<%= post.postId %>')"> <!-- Pass the specific buttons ID -->
                  <div class="dot"></div>
                  <div class="dot"></div>
                  <div class="dot"></div>
                </div>
                <div class="buttons" id="buttons-<%= post.postId %>"> <!-- Initially hidden -->
                  <div class="d-flex justify-content-end align-items-center me-1">
                    <div class="d-flex align-items-center me-4">
                      <% if (userId !== post.userId) { %>
                        <form action="/createConv" method="POST" class="ms-4">
                          <input type="hidden" id="userId2" value="<%= post.userId %>" name="userId2" />
                          <button type="submit" class="btn btn-link p-0 border-0 me-2">Message</button>
                        </form>
                      <% } %>
                      <button type="button" class="grows btn btn-link p-0 border-0 me-2" onclick="toggleReplySection('<%= post.postId %>')">
                        <img src="/images/comment.png" alt="Comment" width="40vw" height="40vw" />
                      </button>
                      <div class="text-muted small"><%= post.commentCount %> comments</div>
                    </div>
                    <div class="d-flex align-items-center me-4">
                      <button type="submit" id="likeButton" class="grows btn btn-link p-0 border-0 me-2" onclick="toggleLike(event)">
                        <input type="hidden" name="postId" value="<%= post.postId %>" />
                        <input type="hidden" name="liked" value="<%= post.liked %>" />
                        <input type="hidden" name="likeCount" value="<%= post.likeCount %>" />
                        <% if (post.liked) { %>
                          <img src="/images/likeClicked.png" alt="Like" width="40vw" height="40vw" />
                        <% } else { %>
                          <img src="/images/likeUnclicked.png" alt="Like" width="40vw" height="40vw" />
                        <% } %>
                      </button>
                      <div class="text-muted small"><%= post.likeCount %> likes</div>
                    </div>
                    <div class="d-flex align-items-center me-4">
                      <% if (post.flagged) { %>
                        <img src="/images/markedFlag.png" alt="Flag" width="40vw" height="40vw" class="me-4" />
                      <% } else { %>
                        <button type="button" id="flagButton" class="grows btn btn-link" data-bs-toggle="modal" data-bs-target="#flagModal" onclick="setFlagModalValues('<%= post.postId %>')">
                          <img src="/images/emptyFlag.png" alt="Flag" width="40vw" height="40vw" class="grows me-4" />
                        </button>
                      <% } %>
                      <div class="d-flex align-items-center me-2">
                        <% if (userId === post.userId) { %>
                          <img class="grows me-4" src="/images/editPost.png" style="cursor: pointer;" alt="editPost" width="40vw" height="40vw" data-bs-toggle="modal" data-bs-target="#editModal" onclick="setEditModalValues('<%= post.postId %>', '<%= post.title %>', '<%= post.courseId %>', '<%= post.description %>')" />
                        <% } %>
                        <% if (userId === post.userId || role === 'teacher' || role === 'moderator') { %>
                          <form action="/deleteUserPost" method="POST">
              
                                      <input type="hidden" id="catId" value="<%= catId %>" name="catId" />
                                      <input type="hidden" name="postId" value="<%= post.postId %>" />
                                      <img class="grows" src="/images/delete.png" style="cursor: pointer me-4;"
                                        alt="editPost" width="35" height="35" data-bs-toggle="modal"
                                        data-bs-target="#editModal"
                                        onclick="setEditModalValues('<%= post.postId %>', '<%= post.title %>', '<%= post.courseId %>', '<%= post.description %>')">

                                    </form>
                                    <% } %>

                            </div>
                            <!-- <button type="button" id="flagButton"
                                                      class="btn btn-link p-0 border-0 me-2" onclick="toggleFlag(event)">
                                                      <img src="/images/emptyFlag.png" alt="Flag" width="40" height="40">
                                                  </button> -->
                    </div>
                  </div>

                </div>
                <div
                style="width: 60vw; height: 6.2vh; left: 25vw; top: 15vh; position: absolute; color: black; font-size: 2vw; font-family: Inter; font-weight: 700; word-wrap: break-word;">
                <%= post.title %>
              </div>
              <div
                style="width: 60vw; height: 6.2vh; left: 15vw; top: 20vh; position: absolute; color: black; font-size: 1.2vw; font-family: Inter; font-weight: 400; word-wrap: break-word;">
                <%= post.description %>
              </div>
              </div>

              <!-- <div class="replies"> -->
              <!-- Dynamically calculate height -->
              <span class="reply-section" id="reply-section-<%= post.postId %>" style="display: none;">
                <% if (!post.replies || post.replies.length===0) { %>
                  <!-- <p>No replies found, be the first to make one!</p> -->
                <% } else { %>
                  <% post.replies.forEach(reply=> { %>
                    <div style="width: 1vw; height: 8vh; left: 10vw; top: -1.5vh; position: relative; display: flex; flex-direction: column; background: black; pointer-events: none;"> </div>
                    <div class="grows" style="position: relative; margin-bottom: -13.3vh; display: flex; flex-direction: column; background: white; top: -8vh;">
                      <div class="grows" style="width: 4vw; height: 4vh; left: 12vw; top: 4vh; position: absolute; background: rgb(255, 255, 255); border-radius: 50%; border: 0.1vw black solid; z-index: 1;">
                        <a href="/account/<%= reply.userId %>">
                          <img src="/images/<%= reply.profilePic %>" class="rounded-circle" alt="profile" style="width: 100%; height: 100%; object-fit: cover;">
                        </a>
                      </div>
                      <div style="width: 13.5vw; height: 10vh; left: 17vw; top: 4.5vh; position: absolute; z-index: 1;">
                        <span style="color: black; font-size: 2vw; font-family: Inter; font-weight: 400; word-wrap: break-word"><%= reply.fname + " " + reply.lname %>-</span>
                        <span style="color: black; font-size: 1.2vw; font-family: Inter; font-weight: 400; word-wrap: break-word"><%= reply.description %></span>
                      </div>
                      <div id="postBox" style="width: 32vw; height: 20vh; left: 10vw; top: 1.5vh; position: absolute; background: rgb(115, 113, 124); border-radius: 1.9vw; border: 0.1vw rgba(13.75, 61.79, 253.94, 0.20) solid;"> </div>
                      <div id="dots" class="grows" style="position: absolute; left: 38vw; top: 9vh;">
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                      </div>
                    </div>
                    <div style="width: 1.2vw; position: relative; background: black; left: 45vw; top: 4vh; height: 24vh;"> </div>
                  <% }) %>
                  <div class="grows" style="position: relative; margin-bottom: 10vh; display: flex; flex-direction: column;">
                    <div style="width: 15.7vw; height: 2.9vh; left: 4vw; top: 2.8vh; z-index: 2; position: absolute; color: black; font-size: 20px; font-family: Inter; font-weight: 400; word-wrap: break-word;">
                      <form action="/reply" method="POST">
                        <input type="hidden" id="userId" value="<%= userId %>" name="userId" />
                        <input type="hidden" id="catId" value="<%= catId %>" name="catId" />
                        <input type="hidden" id="replyPostId" value="<%= post.postId %>" name="postId" />
                        <textarea style="width: 40.4vw; height: 3.5vh; border-radius: 8vh; border: 0.2vw black solid; resize: none; overflow: hidden; padding-left: 1vw; padding-bottom: 2vw;" placeholder="Comment here" name="description"></textarea>
                        <div style="width: 1vw; height: 1vh; left: 35vw; top: 0; z-index: 2; position: absolute; color: black; font-size: 2vw; font-family: Inter; font-weight: 400; word-wrap: break-word;">
                          <!-- <button type="submit">Comment</button> -->
                        </div>
                      </form>
                    </div>
                    <div id="postBox" style="width: 45vw; height: 5.1vh; left: 3vw; top: 12.2vh; position: absolute; background: rgb(255, 255, 255); box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25); border-radius: 6.5vw; border: 0.2vw black solid;"> </div>
                  </div>
              
              <% } %>
            </span>

                <% }) %>
                  <% } %>
      </div>





      <style>
        .grows {
          display: inline-block;
          /* Ensure the element behaves like a block for scaling */

        }

        .grows:hover {
          transform: scale(1.1);
          /* Increase size by 20% */
          transform-origin: center;
          /* Center the scaling */
          transition: transform 0.3s ease;
          /* Smooth transition */
          z-index: 1;
        }


        #postBox:hover,
        .grows:hover #postBox {
          box-shadow: 0px 0px 4px 5px rgba(0, 0, 0, 0.25);
        }


        #dots {
        display: flex;
        flex-direction: column;
        gap: 0.8vh; /* Adjust spacing as needed */
      }

      .dot {
        width: .7vh;
        height: .7vh;
        background: #0D0D0D;
        border-radius: 50%;
        z-index: 1;
      }

      .buttons {
        width: 35.5vw;
        height: 5vh;
        left: 11vw;
        top: 21.6vh;
        position: absolute;
        opacity: 0.8;
        background: #D9D9D9;
        border-radius: 1.1vw;
        transform: translateX(50%) scale(0); /* Start off screen to the right */
        transition: transform 1s ease; /* Add transition for sliding */
        opacity: 0; /* Make it transparent initially */
        pointer-events: none; /* Prevent interaction when not visible */
        display: flex; /* Use flexbox */
        flex-direction: column; /* Stack items vertically */
        align-items: center; /* Center items horizontally */
        justify-content: center; /* Center items vertically */
      }


        .buttons.visible {
          transform: translateX(0%) scale(1);
          /* Slide into position */
          opacity: 1;
          /* Make it visible */
          pointer-events: auto;
          /* Allow interaction when visible */
          /* transform: scale(1); */
        }
      </style>



      <!-- Resource feed -->
      <div id="resources-content" style="display: none">
        <h2>Resources</h2>
        <% if (!resources || resources.length===0) { %>
          <h2>No resources found, be the first to make one!</h2>
          <% } else { %>
            <% resources.forEach(resource=> { %>
              <div class="resource">
                <div class="card">
                  <div class="card-header">
                    <h2>
                      <%= resource.title %>
                    </h2>
                  </div>
                  <div class="card-body d-flex justify-content-between align-items-center">
                    <div class="flex-grow-1 text-center">
                      <a href="https://<%= resource.url %>" class="btn btn-link">
                        <%= resource.url %>
                      </a>
                    </div>
                    <form action="/download/<%= resource.fileName %>" method="get" class="d-inline">
                      <input type="hidden" name="fileName" value="<%= resource.fileName %>" />
                      <button type="submit" class="btn btn-primary">
                        Download
                      </button>
                    </form>
                    <% if (role==='teacher' ) { %>
                      <form action="/deleteResource" method="POST" class="d-inline">
                        <input type="hidden" name="resourceId" value="<%= resource.resourceId %>" />
                        <input type="hidden" name="catId" value="<%= catId %>" />
                        <input type="hidden" name="fileName" value="<%= resource.fileName %>" />
                        <button type="submit" class="btn btn-danger">Delete</button>
                      </form>
                      <% } %>
                  </div>
                </div>
              </div>
              <br>
              <% }) %>
                <% } %>
      </div>
    </div>

    <!-- Message bar -->
    <div id="private-messages">

      <h1 id="pm-header">Private Messages</h1>
      <% if (convUsers) { %>
        <ul class="users">
          <% convUsers.forEach(user=> { %>

            <div style="position: relative; margin-bottom: 2vh; display: flex; flex-direction: column;">
              <div style="width: 90%; height: 9vh; background: #16316b; box-shadow: 0px 0px 0px .3vw rgba(0, 0, 0, 0.25); border-radius: 15vw; border: 0.15vw #fac104 solid; display: flex; align-items: center; justify-content: space-between; padding: 1vw;">
                <div style="display: flex; align-items: center;">
                  <div class="grows" style="width: 3vw; height: 3vw; background: #D9D9D9; border-radius: 50%; overflow: hidden;">
                    <a href="/account/<%= user.otherUser.userId %>">
                      <img src="/images/<%= user.otherUser.profilePic %>" class="rounded-circle" alt="profile" style="width: 100%; height: 100%; object-fit: cover;">
                    </a>
                  </div>
                  <div style="margin-left: 1vw;">
                    <a href="/account/<%= user.otherUser.userId %>">
                      <span class="pm-name"><%= user.otherUser.fname + " " + user.otherUser.lname %></span>
                    </a>
                  </div>
                </div>
                <div style="display: flex; align-items: center;">
                  <!-- <div style="width: 2vw; height: 2vh; background: #dbd1d1; z-index: 1;"></div> -->
                  <form action="/getMessagePage" method="GET" style="margin-left: 1vw;">
                    <input type="hidden" name="convId" value="<%= user.convId %>" />
                    <button type="submit" style="border: none; background: none; padding: 0;">
                      <div style="position: relative;">
                      <img class="grows" src="/images/whiteMail.png" alt="Message Icon" style="width: 60px; height: 70px;">
                      <div style="position: absolute; top: 0; width: 15px; height: 15px; font-size: 20px; font-family: Inter; font-weight: bold; word-wrap: break-word; text-align: center;">
                        <% if (user.unreadCount > 0) { %>
                          <p style="color: rgb(255, 196, 0);"><%= user.unreadCount %></p>
                          <% } else { %>
                            <p style="color: rgb(255, 255, 255);"><%= user.unreadCount %></p>
                            <% } %>
                        
                      </div>
                    </div>
                    </button>
                  </form>
                  <!-- <div style="width: 2vw; height: 2vh; left: vw; color: black; font-size: 1.2vw; font-family: Inter; font-weight: bold; word-wrap: break-word; text-align: center;">
                    <%= user.unreadCount %>
                  </div> -->
                </div>
              </div>
            </div>
            
            
            <!-- <li class="user-info"> -->
            <!-- <a href="/account/<%= user.otherUser.userId %>">
              <img
                src="/images/<%= user.otherUser.profilePic %>"
                class="rounded-circle"
                alt="profile"
                height="40"
              />
              <span>
                <%= user.otherUser.fname + " " + user.otherUser.lname %>
              </span>
            </a>
            <span> <%= user.unreadCount %> unread messages </span>
            <form action="/getMessagePage" method="GET">
              <input type="hidden" name="convId" value="<%= user.convId %>" />
              <button type="submit" class="btn btn-primary">Message</button>
            </form> -->
            <!-- </li> -->
            <!-- <br /> -->
            <% }) %>
        </ul>
        <% } %>
    </div>
  </div>

  <!-- Resource modal -->
  <div class="modal fade" id="resourceModal" tabindex="-1" aria-labelledby="resourceModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="postModalLabel">Add a resource</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form action="/upload" method="POST" enctype="multipart/form-data">
          <input type="hidden" id="catId" value="<%= catId %>" name="catId" />
          <div class="modal-body">
            <div class="mb-3">
              <label for="title" class="form-label">Title</label>
              <input type="text" class="form-control" id="title" name="title" required />
            </div>
            <div class="mb-3">
              <label for="description" class="form-label">Link</label>
              <textarea class="form-control" id="url" name="url" rows="1"></textarea>
            </div>
            <div class="mb-3">
              <label for="fileUpload" class="form-label">File upload?</label>
              <input type="file" class="form-control" id="fileUpload" name="file" />
            </div>
          </div>
          <div class="modal-footer border-top">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              Close
            </button>
            <button type="submit" class="btn btn-primary">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Post modal -->
  <div class="modal fade" id="postModal" tabindex="-1" aria-labelledby="postModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="postModalLabel">Create a Post</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form action="/post" method="POST">
          <input type="hidden" id="catId" value="<%= catId %>" name="catId" />
          <div class="modal-body">
            <div class="mb-3">
              <label for="title" class="form-label">Title</label>
              <input type="text" class="form-control" id="title" name="title" required />
            </div>
            <div class="mb-3">
              <label for="courseId" class="form-label">Course ID</label>
              <input type="number" class="form-control" id="courseId" name="courseId" min="100" max="999" required />
            </div>
            <div class="mb-3">
              <label for="description" class="form-label">Description</label>
              <textarea class="form-control" id="description" name="description" rows="4" required></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              Close
            </button>
            <button type="submit" class="btn btn-primary">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Edit post modal -->
  <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editModalLabel">Edit Post</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form action="/editPost" method="POST">
          <input type="hidden" id="catId" value="<%= catId %>" name="catId" />
          <input type="hidden" id="postId" name="postId" />

          <div class="modal-body">
            <div class="mb-3">
              <label for="editTitle" class="form-label">Title</label>
              <input type="text" class="form-control" id="editTitle" name="editTitle" required />
            </div>
            <div class="mb-3">
              <label for="editCourseId" class="form-label">Course ID</label>
              <input type="number" class="form-control" id="editCourseId" name="editCourseId" min="100" max="999"
                required />
            </div>
            <div class="mb-3">
              <label for="editDescription" class="form-label">Description</label>
              <textarea class="form-control" id="editDescription" name="editDescription" rows="4" required></textarea>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              Close
            </button>
            <button type="submit" class="btn btn-primary">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Edit reply modal -->
  <div class="modal fade" id="editReplyModal" tabindex="-1" aria-labelledby="editReplyModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editReplyModalLabel">Edit Reply</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form action="/editReply" method="POST">
          <input type="hidden" id="catId" value="<%= catId %>" name="catId" />
          <input type="hidden" id="replyId" name="replyId" />

          <div class="modal-body">
            <div class="mb-3">
              <label for="editDescription" class="form-label">Description</label>
              <textarea class="form-control" id="editDescription" name="editDescription" rows="4" required></textarea>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              Close
            </button>
            <button type="submit" class="btn btn-primary">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Reply modal -->
  <div class="modal fade" id="replyModal" tabindex="-1" aria-labelledby="replyModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="replyModalLabel">Reply</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form action="/reply" method="POST">
          <input type="hidden" id="catId" value="<%= catId %>" name="catId" />
          <input type="hidden" id="replyPostId" name="postId" />
          <div class="modal-body">
            <div class="mb-3">
              <label for="description" class="form-label">Description</label>
              <textarea class="form-control" id="description" name="description" rows="4" required></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              Close
            </button>
            <button type="submit" class="btn btn-primary">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Flag modal -->
  <div class="modal fade" id="flagModal" tabindex="-1" aria-labelledby="flagModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="flagModalLabel">Confirm Flagging</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">Are you sure you want to flag this post?</div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            Cancel
          </button>
          <form action="/flagPost" method="POST">
            <input type="hidden" id="catId" value="<%= catId %>" name="catId" />
            <input type="hidden" id="flagPostId" name="postId" />
            <button type="submit" class="btn btn-primary">Flag</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Filter modal -->
<div class="modal fade" id="filterModal" tabindex="-1" aria-labelledby="filterModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="filterModalLabel">Filter Posts</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form action="/filterPosts" method="GET">
        <div class="modal-body">
          <input type="hidden" id="catId" value="<%= catId %>" name="catId" />
          
          <div class="mb-3">
            <label for="filterUserSelect" class="form-label">Select User</label>
            <select class="form-select" id="filterUserSelect" name="userId">
              <option value="All" selected>All</option>
              <% 
                const uniqueUsers = new Set();
                posts.forEach(post => {
                  const userFullName = post.fname + " " + post.lname;
                  if (!uniqueUsers.has(userFullName)) {
                    uniqueUsers.add(userFullName);
              %>
                <option value="<%= post.userId %>">
                  <%= userFullName %>
                </option>
              <% 
                  }
                }); 
              %>
            </select>
          </div>
          <hr>
          
          <div class="mb-3">
            <label for="filterCourseSelect" class="form-label">Select Course</label>
            <select class="form-select" id="filterCourseSelect" name="courseId">
              <option value="All" selected>All</option>
              <% 
                const uniqueCourses = new Set();
                posts.forEach(post => {
                  if (!uniqueCourses.has(post.courseId)) {
                    uniqueCourses.add(post.courseId);
              %>
                <option value="<%= post.courseId %>">
                  <%= post.courseId %>
                </option>
              <% 
                  }
                }); 
              %>
            </select>
          </div>
          <hr>

          <div class="mb-3">
            <label for="filterTitleSelect" class="form-label">Select Title</label>
            <select class="form-select" id="filterTitleSelect" name="title">
              <option value="All" selected>All</option>
              <% 
                const uniqueTitles = new Set();
                posts.forEach(post => {
                  if (!uniqueTitles.has(post.title)) {
                    uniqueTitles.add(post.title);
              %>
                <option value="<%= post.title %>">
                  <%= post.title %>
                </option>
              <% 
                  }
                }); 
              %>
            </select>
          </div>
          <hr>

          <div class="mb-3">
            <label for="filterDateRange" class="form-label">Select Date </label><br>
            <input type="text" name="daterange" value="" />
          </div>

          <div class="d-flex justify-content-end">
            <button type="submit" class="btn btn-primary" id="filterButton">Apply Filter</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>

  <script>
    function setReplyModalValues(postId) {
      document.getElementById("replyPostId").value = postId;
    }

    function setEditModalValues(postId, title, courseId, description) {
      document.getElementById("postId").value = postId;
      document.getElementById("editTitle").value = title;
      document.getElementById("editCourseId").value = courseId;
      document.getElementById("editDescription").value = description;
    }

    function setEditReplyModalValues(replyId, description) {
      document.getElementById("replyId").value = replyId;
      document.getElementById("editDescription").value = description;
    }

    function setFlagModalValues(postId) {
      document.getElementById("flagPostId").value = postId;
    }

    $(function () {
      $('input[name="daterange"]').daterangepicker({
        opens: 'left'
      }, function (start, end, label) {
        console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
      });
    });

    function toggleButtons(buttonId) {
      const buttonDiv = document.getElementById(buttonId); // Get the specific buttons div
      const isVisible = buttonDiv.classList.contains("visible"); // Check current visibility
      if (isVisible) {
        buttonDiv.classList.remove("visible"); // Remove visible class
      } else {
        buttonDiv.classList.add("visible"); // Add visible class
      }
    }

    function toggleReplySection(postId) {
      const replySection = document.getElementById(`reply-section-${postId}`);
      if (replySection.style.display === "none" || replySection.style.display === "") {
        replySection.style.display = "block"; // Show the reply section
      } else {
        replySection.style.display = "none"; // Hide the reply section
      }
    }

  </script>
</body>

</html>